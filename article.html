<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memuat Artikel... | EndSiena</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css"> <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: { brand: { primary: '#0284c7', darkPrimary: '#38bdf8', bgDark: '#020617' } }
                }
            }
        }
    </script>
</head>
<body class="bg-white dark:bg-[#020617] transition-colors duration-300">

    <div class="fixed top-0 left-0 h-1 bg-sky-500 z-[60]" id="scroll-progress" style="width: 0%"></div>

    <nav class="fixed top-0 left-0 right-0 z-50 h-16 px-4 md:px-8 flex items-center justify-between bg-white/90 backdrop-blur-md border-b border-slate-200 dark:bg-[#020617]/90 dark:border-white/5">
        
        <button onclick="window.location.href='index.html'" class="flex items-center gap-2 px-3 py-2 rounded-xl text-sky-600 dark:text-teal-400 font-bold text-xs uppercase tracking-widest hover:bg-sky-50 dark:hover:bg-white/5 transition-all group">
            <i data-lucide="arrow-left" class="w-4 h-4 group-hover:-translate-x-1 transition-transform"></i> 
            <span class="lang-back">KEMBALI</span>
        </button>

        <div class="flex items-center gap-3">
            <button onclick="toggleLanguage()" class="px-3 py-1 rounded-lg border border-slate-200 dark:border-white/10 text-[10px] font-black uppercase tracking-widest hover:bg-slate-100 dark:hover:bg-white/5 transition-all">
                <span id="langDisplay">ID</span>
            </button>
            
            <button onclick="toggleTheme()" class="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-all text-orange-500 dark:text-teal-400">
                <i id="themeIcon" data-lucide="sun" class="w-5 h-5"></i>
            </button>
        </div>
    </nav>

    <main class="pt-24 pb-20 px-4 md:px-8 max-w-3xl mx-auto min-h-screen">
        
        <div id="loadingState" class="flex flex-col items-center justify-center py-40 space-y-4">
            <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-sky-600 dark:border-teal-400"></div>
            <p class="font-mono text-xs text-slate-500 animate-pulse lang-loading">MENDEKRIPSI DATA...</p>
        </div>

        <article id="articleContent" class="hidden fade-in space-y-8">
            
            <div class="rounded-3xl overflow-hidden shadow-2xl mb-8">
                <img id="artImage" src="" class="w-full h-auto max-h-[400px] object-cover">
            </div>

            <div class="space-y-4 border-b border-slate-200 dark:border-white/10 pb-8">
                <div id="artTags" class="flex flex-wrap gap-2"></div>
                
                <h1 id="artTitle" class="text-3xl md:text-4xl font-black text-slate-900 dark:text-white leading-tight"></h1>
                
                <div class="flex items-center gap-4 text-xs font-mono text-slate-500 font-bold uppercase">
                    <span class="flex items-center gap-2"><i data-lucide="calendar" class="w-3 h-3"></i> <span id="artDate"></span></span>
                    <span class="flex items-center gap-2"><i data-lucide="user" class="w-3 h-3"></i> <span>IWANSENA</span></span>
                </div>
            </div>

            <div id="artBody" class="prose prose-lg prose-slate dark:prose-invert max-w-none 
                prose-a:text-sky-600 dark:prose-a:text-teal-400 prose-img:rounded-xl">
            </div>

            <div class="pt-10 mt-10 border-t border-slate-200 dark:border-white/10">
                <h4 class="font-black text-xs uppercase tracking-[0.2em] mb-4 text-slate-400 lang-share">BAGIKAN ARTIKEL</h4>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                    <button onclick="shareTo('wa')" class="flex items-center justify-center gap-2 py-3 rounded-xl bg-green-500/10 text-green-600 hover:bg-green-500 hover:text-white transition-all font-bold text-xs uppercase">
                        <i data-lucide="message-circle" class="w-4 h-4"></i> WhatsApp
                    </button>
                    <button onclick="shareTo('tg')" class="flex items-center justify-center gap-2 py-3 rounded-xl bg-blue-500/10 text-blue-600 hover:bg-blue-500 hover:text-white transition-all font-bold text-xs uppercase">
                        <i data-lucide="send" class="w-4 h-4"></i> Telegram
                    </button>
                    <button onclick="shareTo('tw')" class="flex items-center justify-center gap-2 py-3 rounded-xl bg-slate-500/10 text-slate-600 dark:text-slate-300 hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black transition-all font-bold text-xs uppercase">
                        <i data-lucide="twitter" class="w-4 h-4"></i> X / Twitter
                    </button>
                    <button onclick="shareTo('cp')" class="flex items-center justify-center gap-2 py-3 rounded-xl border border-slate-200 dark:border-white/10 hover:bg-slate-100 dark:hover:bg-white/5 transition-all font-bold text-xs uppercase">
                        <i data-lucide="link" class="w-4 h-4"></i> Copy Link
                    </button>
                </div>
            </div>

        </article>
    </main>

    <script>
        // --- 1. THEME LOGIC ---
        let isDark = localStorage.getItem('theme') === 'dark';
        
        function applyTheme() {
            if(isDark) {
                document.documentElement.classList.add('dark');
                document.getElementById('themeIcon').setAttribute('data-lucide', 'moon');
            } else {
                document.documentElement.classList.remove('dark');
                document.getElementById('themeIcon').setAttribute('data-lucide', 'sun');
            }
            lucide.createIcons();
        }
        
        function toggleTheme() {
            isDark = !isDark;
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            applyTheme();
        }
        applyTheme(); // Run on load

        // --- 2. LANGUAGE LOGIC (Manual Dictionary) ---
        let currentLang = localStorage.getItem('lang') || 'ID'; // Default Indo
        
        // Kamus Sederhana untuk UI
        const dict = {
            'ID': { back: 'KEMBALI', loading: 'MENDEKRIPSI DATA...', share: 'BAGIKAN TRANSMISI' },
            'EN': { back: 'BACK TO FEED', loading: 'DECRYPTING DATA...', share: 'SHARE TRANSMISSION' }
        };

        function applyLang() {
            document.getElementById('langDisplay').innerText = currentLang;
            // Update UI Text
            document.querySelector('.lang-back').innerText = dict[currentLang].back;
            document.querySelector('.lang-loading').innerText = dict[currentLang].loading;
            document.querySelector('.lang-share').innerText = dict[currentLang].share;
        }

        function toggleLanguage() {
            currentLang = currentLang === 'ID' ? 'EN' : 'ID';
            localStorage.setItem('lang', currentLang); // Simpan pilihan user
            applyLang();
            // Catatan: Ini TIDAK menerjemahkan isi artikel, hanya UI.
        }
        applyLang(); // Run on load

        // --- 3. ARTICLE LOAD LOGIC ---
        async function loadArticle() {
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug');

            if (!slug) { window.location.href = 'index.html'; return; }

            try {
                // Fetch Index & Content
                const indexRes = await fetch('index.json');
                const posts = await indexRes.json();
                const post = posts.find(p => p.slug === slug);

                let contentHTML = "";
                
                // Prioritas: Cek di JSON dulu, kalau gak ada baru cari file .html
                if (post && post.content) {
                    contentHTML = post.content;
                } else {
                    // Fallback ke file HTML terpisah
                    // PERBAIKAN PATH: Pastikan script mencari di folder 'posts/' jika struktur Anda sudah diperbaiki
                    // Jika file artikel ada di root, gunakan `${slug}.html`
                    // Jika di folder posts, gunakan `posts/${slug}.html`
                    const contentRes = await fetch(`posts/${slug}.html`); 
                    if(!contentRes.ok) {
                         // Coba cari di root kalau di folder posts gak ada (Backup plan)
                         const rootRes = await fetch(`${slug}.html`);
                         if(!rootRes.ok) throw new Error("Artikel hilang di radar.");
                         contentHTML = await rootRes.text();
                    } else {
                        contentHTML = await contentRes.text();
                    }
                }

                // --- 4. CLEANER LOGIC (Hapus Tulisan Sampah) ---
                // Kita gunakan teknik 'replacing' untuk membuang elemen yang tidak diinginkan
                // Contoh: Menghapus div komentar bawaan CMS
                
                // Opsi A: Hapus string tertentu (Ganti 'Tulisan Aneh' dengan teks yg mau dihapus)
                contentHTML = contentHTML.replace(/Tulisan Sisipan Upam/g, ""); 
                
                // Opsi B: Membungkus konten agar kita bisa manipulasi via DOM nanti
                // (Sudah otomatis aman karena kita inject ke innerHTML)

                // Render Data
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('articleContent').classList.remove('hidden');

                document.getElementById('artTitle').innerText = post ? post.title : 'Data Korup';
                document.getElementById('artDate').innerText = post ? post.date : '-';
                document.getElementById('artImage').src = (post && post.image) ? post.image : 'assets/img/placeholder.jpg';
                
                // Render Tags
                if (post && post.tags) {
                    document.getElementById('artTags').innerHTML = post.tags.map(t => 
                        `<span class="px-2 py-1 bg-slate-100 dark:bg-white/10 text-slate-600 dark:text-slate-300 text-[10px] font-bold uppercase rounded hover:bg-sky-500 hover:text-white transition-colors">#${t}</span>`
                    ).join('');
                }

                // Render Body & Remove Footer Sampah via DOM Manipulation
                const bodyContainer = document.getElementById('artBody');
                bodyContainer.innerHTML = contentHTML;

                // BERSIH-BERSIH LANJUTAN (Hapus elemen terakhir jika itu sampah/navigasi)
                // Kode ini menghapus elemen <hr> atau <div> paling bawah jika mengganggu
                const lastElement = bodyContainer.lastElementChild;
                if(lastElement && (lastElement.tagName === 'HR' || lastElement.innerText.includes('Upam'))) {
                    lastElement.remove();
                }

                document.title = `${post ? post.title : 'Artikel'} | EndSiena`;
                lucide.createIcons();

            } catch (err) {
                console.error(err);
                document.getElementById('loadingState').innerHTML = `<p class="text-red-500 font-mono font-bold">ERROR 404: ARTIKEL HILANG / PERBAIKAN PATH DIPERLUKAN</p>`;
            }
        }

        // --- 5. SHARE FUNCTION ---
        function shareTo(platform) {
            const url = encodeURIComponent(window.location.href);
            const title = encodeURIComponent(document.title);
            let shareUrl = '';

            if (platform === 'wa') shareUrl = `https://wa.me/?text=*${title}*%0A${url}`;
            if (platform === 'tg') shareUrl = `https://t.me/share/url?url=${url}&text=${title}`;
            if (platform === 'tw') shareUrl = `https://twitter.com/intent/tweet?text=${title}&url=${url}`;
            
            if (platform === 'cp') {
                navigator.clipboard.writeText(window.location.href);
                // Ganti icon jadi check sementara
                alert("Link tersalin ke clipboard!"); 
                return;
            }
            window.open(shareUrl, '_blank');
        }

        // Run
        loadArticle();

        // Scroll Bar Logic
        window.onscroll = function() {
            let winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            let height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            let scrolled = (winScroll / height) * 100;
            document.getElementById("scroll-progress").style.width = scrolled + "%";
        };
    </script>
</body>
</html>
